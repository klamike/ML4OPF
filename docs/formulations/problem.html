<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>ml4opf.formulations.problem API documentation</title>
<meta name="description" content="Abstract base class for each OPF problem …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ml4opf.formulations.problem</code></h1>
</header>
<section id="section-intro">
<p>Abstract base class for each OPF problem.</p>
<p>Each formulation should inhereit from <code><a title="ml4opf.formulations.problem.OPFProblem" href="#ml4opf.formulations.problem.OPFProblem">OPFProblem</a></code> and implement the following:
</p>
<ul>
<li>
<p><code>_parse_sanity_check</code>: Use <code>self.train_data</code>, <code>self.test_data</code>, and <code>self.json_data</code> to perform sanity checks making sure they correspond to the same dataset.
</p>
</li>
<li>
<p><code>feasibility_check</code>: Dictionary of keys and values to check feasibility of the problem. Each key is checked to have the corresponding value. If any of them does not match, the sample is removed from the dataset in <code>H5Parser</code> if feasible_only is True.
</p>
</li>
<li>
<p><code>default_combos</code>: A dictionary where keys represent elements of the tuple from the TensorDataset and values are keys of the train_data dictionary which are concatenated. Used by <code>make_dataset</code>.
</p>
</li>
<li>
<p><code>default_order</code>: The order of the keys in the default_combos dictionary.</p>
</li>
</ul>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ml4opf.formulations.problem.OPFProblem"><code class="flex name class">
<span>class <span class="ident">OPFProblem</span></span>
<span>(</span><span>data_directory: str, case_name: str, dataset_name: str, **parse_kwargs)</span>
</code></dt>
<dd>
<div class="desc"><h1 id="opf-problem">OPF Problem</h1>
<p>This class parses the JSON/HDF5 files on initialization, providing a standard interface for accessing OPF data.</p>
<p>OPFProblem also includes methods for creating input/target tensors from the HDF5 data by concatenating keys,
though more complex datasets (e.g., for graph neural networks) can be created by accessing <code>train_data</code> and <code>json_data</code> directly.</p>
<p>By default, initializing OPFProblem will parse the HDF5/JSON files, remove infeasible samples, and set aside 5000 samples for testing.
The test data can be accessed via <code>test_data</code> - <code>train_data</code> will only contain the training data. Models should split the training data into
training/validation sets themselves downstream.</p>
<p>Attributes:</p>
<ul>
<li>
<p><code>path (Path)</code>: Path to the problem file folder</p>
</li>
<li>
<p><code>name (str)</code>: Name of the problem to use</p>
</li>
<li>
<p><code>train_data (dict)</code>: Dictionary of parsed HDF5 data. If <code>make_test_set</code> is True, this is only the training set.</p>
</li>
<li>
<p><code>test_data (dict)</code>: Dictionary of parsed HDF5 data for the test set. If <code>make_test_set</code> is False, this is None.</p>
</li>
<li>
<p><code>json_data (dict)</code>: Dictionary of parsed JSON data.</p>
</li>
<li>
<p><code>violation (OPFViolation)</code>: OPFViolation object for computing constraint violations for this problem.</p>
</li>
</ul>
<p>Methods:</p>
<ul>
<li>
<p><code>parse</code>: Parse the JSON and HDF5 files for the problem</p>
</li>
<li>
<p><code>make_dataset</code>: Create input/target tensors by combining keys from the h5 data. Returns the TensorDataset and slices for extracting the original components.</p>
</li>
<li>
<p><code>slice_batch</code>: Extract the original components from a batch of data given the slices.</p>
</li>
<li>
<p><code>slice_tensor</code>: Extract the original components from a tensor given the slices.</p>
</li>
</ul></div>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/0dd79a5b7ba7e1826bd70d110969c0a986455b93/ml4opf/formulations/problem.py#L27-L252" class="git-link">Browse git</a></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="ml4opf.formulations.acp.problem.ACPProblem" href="acp/problem.html#ml4opf.formulations.acp.problem.ACPProblem">ACPProblem</a></li>
<li><a title="ml4opf.formulations.dcp.problem.DCPProblem" href="dcp/problem.html#ml4opf.formulations.dcp.problem.DCPProblem">DCPProblem</a></li>
<li><a title="ml4opf.formulations.ed.problem.EDProblem" href="ed/problem.html#ml4opf.formulations.ed.problem.EDProblem">EDProblem</a></li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="ml4opf.formulations.problem.OPFProblem.slice_batch"><code class="name flex">
<span>def <span class="ident">slice_batch</span></span>(<span>batch: tuple[torch.Tensor, ...], slices: list[dict[str, slice]])</span>
</code></dt>
<dd>
<div class="desc"><p>Slice the batch tensors into the original tensors</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>batch</code></strong> :&ensp;<code>tuple[Tensor, &hellip;]</code></dt>
<dd>Batch of tensors from the TensorDataset</dd>
<dt><strong><code>slices</code></strong> :&ensp;<code>list[dict[str, slice]]</code></dt>
<dd>List of dictionaries of slices</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>tuple[dict[str, Tensor], &hellip;]</code></dt>
<dd>Sliced tensors</dd>
</dl></div>
</dd>
<dt id="ml4opf.formulations.problem.OPFProblem.slice_tensor"><code class="name flex">
<span>def <span class="ident">slice_tensor</span></span>(<span>tensor: torch.Tensor, slices: dict[str, slice])</span>
</code></dt>
<dd>
<div class="desc"><p>Slice the tensor into the original tensors</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>tensor</code></strong> :&ensp;<code>Tensor</code></dt>
<dd>Tensor to slice</dd>
<dt><strong><code>slices</code></strong> :&ensp;<code>dict[str, slice]</code></dt>
<dd>Dictionary of slices</dd>
</dl>
<h2 id="returns">Returns</h2>
<p><code>dict[str, Tensor]</code>: Sliced tensors</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="ml4opf.formulations.problem.OPFProblem.default_combos"><code class="name">prop <span class="ident">default_combos</span> : dict[str, list[str]]</code></dt>
<dd>
<div class="desc"><p>A dictionary where keys represent elements of the tuple
from the TensorDataset and values are keys of the train_data
dictionary which are concatenated.
Used by <code>make_dataset</code>.</p></div>
</dd>
<dt id="ml4opf.formulations.problem.OPFProblem.default_order"><code class="name">prop <span class="ident">default_order</span> : list[str]</code></dt>
<dd>
<div class="desc"><p>The order of the keys in the default_combos dictionary.</p></div>
</dd>
<dt id="ml4opf.formulations.problem.OPFProblem.default_parse_only"><code class="name">prop <span class="ident">default_parse_only</span> : list[str]</code></dt>
<dd>
<div class="desc"><p>The keys to parse from the HDF5 file.</p>
<p>By default, "meta/<em>", "primal/</em>", and "dual/*" are parsed from the data file
and the entire input file is parsed.</p></div>
</dd>
<dt id="ml4opf.formulations.problem.OPFProblem.feasibility_check"><code class="name">prop <span class="ident">feasibility_check</span> : dict[str, str]</code></dt>
<dd>
<div class="desc"><p>Dictionary of keys and values to check feasibility of the problem.</p>
<p>Each key is checked to have the corresponding value. If any of them
does not match, the sample is removed from the dataset in <code>OPFGeneratorH5Parser</code>.
See ACOPFProblem.feasibility_check for an example.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="ml4opf.formulations.problem.OPFProblem.make_dataset"><code class="name flex">
<span>def <span class="ident">make_dataset</span></span>(<span>self, combos: Optional[dict[str, list[str]]] = None, order: Optional[list[str]] = None, test_set: bool = False, sanity_check: bool = True) ‑> tuple[dict[str, torch.Tensor], list[dict[str, slice]]]</span>
</code></dt>
<dd>
<div class="desc"><p>Make a TensorDataset from self.train_data given the keys in combos and the order of the keys in order.</p></div>
</dd>
<dt id="ml4opf.formulations.problem.OPFProblem.parse"><code class="name flex">
<span>def <span class="ident">parse</span></span>(<span>self, parse_only: Union[str, list[str], ForwardRef(None)] = 'default', train_set_size: Optional[int] = None, feasible_only: Union[bool, dict[str, str]] = True, make_test_set: bool = True, test_set_size: int = 5000, convert_to_float32: bool = True, total_load_range: tuple[typing.Optional[float], typing.Optional[float]] = (None, None), sanity_check: bool = True)</span>
</code></dt>
<dd>
<div class="desc"><p>Parse the JSON and HDF5 files for the problem</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ml4opf.formulations" href="index.html">ml4opf.formulations</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ml4opf.formulations.problem.OPFProblem" href="#ml4opf.formulations.problem.OPFProblem">OPFProblem</a></code></h4>
<ul class="two-column">
<li><code><a title="ml4opf.formulations.problem.OPFProblem.default_combos" href="#ml4opf.formulations.problem.OPFProblem.default_combos">default_combos</a></code></li>
<li><code><a title="ml4opf.formulations.problem.OPFProblem.default_order" href="#ml4opf.formulations.problem.OPFProblem.default_order">default_order</a></code></li>
<li><code><a title="ml4opf.formulations.problem.OPFProblem.default_parse_only" href="#ml4opf.formulations.problem.OPFProblem.default_parse_only">default_parse_only</a></code></li>
<li><code><a title="ml4opf.formulations.problem.OPFProblem.feasibility_check" href="#ml4opf.formulations.problem.OPFProblem.feasibility_check">feasibility_check</a></code></li>
<li><code><a title="ml4opf.formulations.problem.OPFProblem.make_dataset" href="#ml4opf.formulations.problem.OPFProblem.make_dataset">make_dataset</a></code></li>
<li><code><a title="ml4opf.formulations.problem.OPFProblem.parse" href="#ml4opf.formulations.problem.OPFProblem.parse">parse</a></code></li>
<li><code><a title="ml4opf.formulations.problem.OPFProblem.slice_batch" href="#ml4opf.formulations.problem.OPFProblem.slice_batch">slice_batch</a></code></li>
<li><code><a title="ml4opf.formulations.problem.OPFProblem.slice_tensor" href="#ml4opf.formulations.problem.OPFProblem.slice_tensor">slice_tensor</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
